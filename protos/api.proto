syntax = "proto3";

enum MessageType {
  MOVE = 0;
  TURN_KEY = 1;
  PLAYER_MOVE = 2;
  UNFOCUS_WINDOW = 3;
  ADD_VOXELS = 4;
  CLEAR_VOXELS = 5;
  CONFIRM_ACTION = 6;
  QUIT = 7;
  KEY_REPLAY = 8;
  STATUS = 9;
  POINTER_REPLAY = 10;
  ADD_COMPONENT = 11;
  DELETE_COMPONENT = 12;
  EDIT_COMPONENT = 13;
  CREATE_ENTITY = 14;
  DELETE_ENTITY = 15;
  LIST_ENTITIES = 16;
  GET_COMPONENT = 17;
}

message NoPayload {}

message Vector {
  float x = 1;
  float y = 2;
  float z = 3;
}

message Range {
  float min = 1;
  float max = 2;
}

message PlayerMove {
  Vector position = 1;
  Vector rotation = 2;
  float unitsPerSecond = 3;
}

message VoxelCoord {
  float x = 1;
  float y = 2;
  float z = 3;
}

message AddVoxels {
  repeated VoxelCoord voxels = 1;
  bool replace = 2;
  float size = 3;
  Vector color = 4;
}

message ClearVoxels {
  Range x = 1;
  Range y = 2;
  Range z = 3;
}

message ConfirmAction {
  int64 actionId = 1;
}

message KeyReplayEntry {
  string sym = 1;       // XKB keysym name (e.g., "v", "Super_L")
  uint32 delay_ms = 2;  // Wait time after this key press before next entry
}

message KeyReplay {
  repeated KeyReplayEntry entries = 1;
}

message PointerReplayEntry {
  uint32 button = 1;    // linux/input-event-codes BTN_* value
  bool pressed = 2;     // true for press, false for release
  uint32 delay_ms = 3;  // Wait time after this pointer event before next entry
}

message PointerReplay {
  repeated PointerReplayEntry entries = 1;
}

message CreateEntity {}

message DeleteEntity {}

message ListEntities {
  ComponentType filter_type = 1;      // Optional: filter by component type
}

message GetComponent {
  ComponentType component_type = 1;   // Component to fetch for entityId
}

message EngineStatus {
  uint32 total_entities = 1;
  uint32 wayland_apps = 2;
  bool wayland_focus = 3;
  Vector camera_position = 4;
}

message Move {
  float xDelta = 1;
  float yDelta = 2;
  float zDelta = 3;
  float unitsPerSecond = 4;
}

message TurnKey {
  bool on = 2;
}

message ApiRequest {
  int64 entityId = 1;
  MessageType type = 2;
  oneof payload {
    Move move = 3;
    TurnKey turnKey = 4;
    PlayerMove playerMove = 5;
    NoPayload noPayload = 6;
    AddVoxels addVoxels = 7;
    ClearVoxels clearVoxels = 8;
    ConfirmAction confirmAction = 9;
    KeyReplay keyReplay = 10;
    PointerReplay pointerReplay = 11;
    AddComponent addComponent = 12;
    DeleteComponent deleteComponent = 13;
    EditComponent editComponent = 14;
    CreateEntity createEntity = 15;
    DeleteEntity deleteEntity = 16;
    ListEntities listEntities = 17;
    GetComponent getComponent = 18;
  }
}

message ApiRequestResponse {
  int64 requestId = 1;
  int64 actionId = 2;
  bool success = 3;
  EngineStatus status = 4;
  repeated int64 entity_ids = 5;      // For LIST_ENTITIES
  Component component = 6;            // For GET_COMPONENT
  repeated EntityComponentInfo entity_components = 7; // For LIST_ENTITIES
}

message EntityComponentInfo {
  int64 entity_id = 1;
  repeated ComponentType component_types = 2;
}

enum ComponentType {
  COMPONENT_TYPE_UNSPECIFIED = 0;
  COMPONENT_TYPE_POSITIONABLE = 1;
  COMPONENT_TYPE_MODEL = 2;
  // Add new component types here as needed
}

message PositionableComponent {
  int64 entityId = 1;                  // Primary key, corresponds to the entity
  Vector position = 2;                 // World-space position
  Vector rotation = 3;                 // Euler angles or quaternion (replicated as a Vector)
  float scale = 4;                     // Uniform scale factor
  Vector origin = 5;                   // Origin/pivot for transforms
}

message ModelComponent {
  int64 entityId = 1;                  // Primary key, corresponds to the entity
  string model_path = 2;               // Filepath or asset reference for 3D model
}

message Component {
  ComponentType type = 1;              // Specifies the type of the component.
  oneof component_type {
    PositionableComponent positionable = 2;
    ModelComponent model = 3;
  }
}

message AddComponent {
  Component component = 1;             // Component to add (see oneof)
}

message DeleteComponent {
  ComponentType component_type = 1;    // Enum value for the type of the component being removed
}

message EditComponent {
  Component component = 1;             // Updated component data (see oneof)
}




